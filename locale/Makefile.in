prefix=@prefix@
LOCALEDIR=@localedir@
DESTDIR=
INSTALL=     @INSTALL@
MAIN_POT=cosign.pot
SUB_POT=addition.pot

TARGETS=zh

all: mo

pot: $(wildcard ../cgi/*.c) ../cgi/cosigncgi.h
	xgettext -s -k_ -o cosign.pot $^

po: pot
	for i in ${TARGETS}; do \
	    msgmerge  -s -o $$i/LC_MESSAGES/MAIN_POT.po $$i/LC_MESSAGES/cosign.po $(MAIN_POT); \
	    msgmerge  -s -o $$i/LC_MESSAGES/SUB_POT.po  $$i/LC_MESSAGES/cosign.po $(SUB_POT); \
	    msgcat    -s -o $$i/LC_MESSAGES/NEW_POT.po  $$i/LC_MESSAGES/MAIN_POT.po $$i/LC_MESSAGES/SUB_POT.po ; \
	    mv $$i/LC_MESSAGES/NEW_POT.po  $$i/LC_MESSAGES/cosign.po ;\
	done

mo:
	for i in ${TARGETS}; do \
	  (cd $$i/LC_MESSAGES; msgfmt -o cosign.mo cosign.po; msgfmt -o template.mo template.po); \
	done

clean:
	-@for i in ${TARGETS}; do \
		(cd $$i/LC_MESSAGES; rm -f *.mo); \
		done

install : all
	-mkdir -p $(DESTDIR)${LOCALEDIR}
	cp -a $(MAIN_POT) ${TARGETS} $(DESTDIR)${LOCALEDIR}

.PHONY: pot po mo clean all install

# vim: noet ts=4 sw=4
