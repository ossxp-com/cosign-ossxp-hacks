prefix=@prefix@
LOCALEDIR=@localedir@
COSIGNTMPLDIR = @prefix@/templates
DESTDIR=
INSTALL=     @INSTALL@

TARGETS=zh

all: mo

pot: $(wildcard ../cgi/*.c) ../cgi/cosigncgi.h
	xgettext -s -k_ -o cosign.pot $^

po: pot
	for i in ${TARGETS}; do \
	    msgmerge  -s -o $$i/LC_MESSAGES/MAIN_POT.po $$i/LC_MESSAGES/cosign.po cosign.pot; \
	    msgmerge  -s -o $$i/LC_MESSAGES/SUB_POT.po  $$i/LC_MESSAGES/cosign.po addition.pot; \
	    msgcat    -s -o $$i/LC_MESSAGES/NEW_POT.po  $$i/LC_MESSAGES/MAIN_POT.po $$i/LC_MESSAGES/SUB_POT.po ; \
	    mv $$i/LC_MESSAGES/NEW_POT.po  $$i/LC_MESSAGES/cosign.po ;\
	done

mo:
	for i in ${TARGETS}; do \
	  (cd $$i/LC_MESSAGES; msgfmt -o cosign.mo cosign.po; msgfmt -o template.mo template.po); \
	done

clean:
	-@for i in ${TARGETS}; do \
		(cd $$i/LC_MESSAGES; rm -f *.mo); \
		done

install : all
	-mkdir -p $(DESTDIR)${LOCALEDIR}
	-mkdir -p $(DESTDIR)${COSIGNTMPLDIR}/locale
	cp cosign.pot   $(DESTDIR)${LOCALEDIR}
	cp template.pot $(DESTDIR)${COSIGNTMPLDIR}/locale
	for i in ${TARGETS}; do \
		mkdir -p $(DESTDIR)${LOCALEDIR}/$$i/LC_MESSAGES; \
		cp $$i/LC_MESSAGES/cosign.* $(DESTDIR)${LOCALEDIR}/$$i/LC_MESSAGES/; \
		mkdir -p $(DESTDIR)${COSIGNTMPLDIR}/locale/$$i/LC_MESSAGES; \
		cp $$i/LC_MESSAGES/template.* $(DESTDIR)${COSIGNTMPLDIR}/locale/$$i/LC_MESSAGES/; \
	done

.PHONY: pot po mo clean all install

# vim: noet ts=4 sw=4
