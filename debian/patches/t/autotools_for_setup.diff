From: Jiang Xin <worldhello.net@gmail.com>
Subject: [PATCH] t/autotools_for_setup

<patch description>

Signed-off-by: Jiang Xin <worldhello.net@gmail.com>

---
 Makefile.in                 |    8 +++-----
 cgi/Makefile.in             |    9 +++++----
 daemon/Makefile.in          |   22 +++++++++++-----------
 filters/apache/Makefile.in  |    6 +++++-
 filters/apache2/Makefile.in |    5 ++++-
 html/Makefile.in            |   25 +++++++++++++------------
 libsnet/Makefile.in         |   15 ++++++++-------
 7 files changed, 49 insertions(+), 41 deletions(-)

diff --git a/Makefile.in b/Makefile.in
index 54d2d22..26f46dc 100755
--- a/Makefile.in
+++ b/Makefile.in
@@ -48,12 +48,10 @@ distclean: clean
 	  common/Makefile version.c filters/common/cosignpaths.h
 	rm -rf autom4te.cache
 
-install: @FILTERS@
+install: @FILTERS@ everything
 	for i in ${FILTERS}; \
-	    do (cd $$i; ${MAKE} ${MFLAGS} install); \
+	    do (cd $$i; ${MAKE} ${MFLAGS} install DESTDIR=$(DESTDIR)); \
 	done
-
-install-all : everything
 	for i in ${TARGETS}; \
-	    do (cd $$i; ${MAKE} ${MFLAGS} install); \
+	    do (cd $$i; ${MAKE} ${MFLAGS} install DESTDIR=$(DESTDIR)); \
 	done
diff --git a/cgi/Makefile.in b/cgi/Makefile.in
index e867410..f80ef24 100755
--- a/cgi/Makefile.in
+++ b/cgi/Makefile.in
@@ -17,6 +17,7 @@ KEYTABPATH = @keytabpath@
 FRIEND_MYSQL_DB = @frienddbhost@
 FRIEND_MYSQL_LOGIN = @frienddblogin@
 FRIEND_MYSQL_PASSWD = @frienddbpasswd@
+DESTDIR=
 
 INCPATH=     @CPPFLAGS@ @KINC@ @MYSQLINC@ -I../common -I../libsnet -I../libcgi
 OPTOPTS=     @OPTOPTS@ @UNIVERSAL_OPTOPTS@
@@ -78,7 +79,7 @@ clean:
 	/bin/rm -rf *.o ${TARGETS}
 
 install : all
-	-mkdir -p ${exec_prefix}
-	-mkdir -p ${CGIDIR};
-	${INSTALL} -m 0755 -c cosign.cgi ${CGIDIR}/;
-	${INSTALL} -m 0755 -c logout ${CGIDIR}/;
+	-mkdir -p $(DESTDIR)${exec_prefix}
+	-mkdir -p $(DESTDIR)${CGIDIR};
+	${INSTALL} -m 0755 -c cosign.cgi $(DESTDIR)${CGIDIR}/;
+	${INSTALL} -m 0755 -c logout $(DESTDIR)${CGIDIR}/;
diff --git a/daemon/Makefile.in b/daemon/Makefile.in
index f03cd51..1c84bc1 100755
--- a/daemon/Makefile.in
+++ b/daemon/Makefile.in
@@ -4,6 +4,7 @@ prefix=@prefix@
 exec_prefix=@exec_prefix@
 SBINDIR=@sbindir@
 MANDIR=@mandir@
+DESTDIR=
 
 COSIGNCONF=@cosignconf@
 COSIGNDB=@cosigndb@
@@ -95,17 +96,16 @@ man : FRC
 	done
 
 install : all man
-	-mkdir -p ${exec_prefix}
-	-mkdir -p ${SBINDIR}
-	${INSTALL} -m 0755 -c cosignd ${SBINDIR}/
-	${INSTALL} -m 0755 -c monster ${SBINDIR}/
-	-mkdir -p ${prefix}
-	-mkdir -p ${MANDIR}
-	-mkdir ${MANDIR}/man5
-	${INSTALL} -m 0644 -c tmp/man/cosign.conf.5 ${MANDIR}/man5/
-	-mkdir ${MANDIR}/man8
-	${INSTALL} -m 0644 -c tmp/man/cosignd.8 ${MANDIR}/man8/
-	${INSTALL} -m 0644 -c tmp/man/monster.8 ${MANDIR}/man8/
+	-mkdir -p $(DESTDIR)${exec_prefix}
+	-mkdir -p $(DESTDIR)${SBINDIR}
+	${INSTALL} -m 0755 -c cosignd $(DESTDIR)${SBINDIR}/
+	${INSTALL} -m 0755 -c monster $(DESTDIR)${SBINDIR}/
+	-mkdir -p $(DESTDIR)${prefix}
+	-mkdir -p $(DESTDIR)${MANDIR}/man5
+	${INSTALL} -m 0644 -c tmp/man/cosign.conf.5 $(DESTDIR)${MANDIR}/man5/
+	-mkdir -p $(DESTDIR)${MANDIR}/man8
+	${INSTALL} -m 0644 -c tmp/man/cosignd.8 $(DESTDIR)${MANDIR}/man8/
+	${INSTALL} -m 0644 -c tmp/man/monster.8 $(DESTDIR)${MANDIR}/man8/
 
 clean :
 	rm -f a.out core* *.o *.bak *[Ee]rrs tags
diff --git a/filters/apache/Makefile.in b/filters/apache/Makefile.in
index 1c3f53a..27ca53d 100755
--- a/filters/apache/Makefile.in
+++ b/filters/apache/Makefile.in
@@ -8,6 +8,8 @@ CC=            	@CC@
 APXS=          	@APXS@
 APACHECTL=     	@APACHECTL@
 INSTALL=       	@INSTALL@
+DESTDIR=
+SBINDIR=@sbindir@
 
 
 #   additional user defines, includes and libraries
@@ -37,7 +39,9 @@ mod_cosign.so: ${SRC}
 #   install the DSO file into the Apache installation
 #   and activate it in the Apache configuration
 install: all
-	$(APXS) -i -a -n 'cosign' mod_cosign.so
+	#$(APXS) -i -a -n 'cosign' mod_cosign.so
+	-mkdir -p $(DESTDIR)${SBINDIR}
+	${INSTALL} -m 0755 -c mod_cosign.la $(DESTDIR)${SBINDIR}/;
 
 #   cleanup
 clean:
diff --git a/filters/apache2/Makefile.in b/filters/apache2/Makefile.in
index e6deae2..efab3f8 100755
--- a/filters/apache2/Makefile.in
+++ b/filters/apache2/Makefile.in
@@ -8,6 +8,8 @@ CC=             @CC@
 APXS2=          @APXS2@
 APACHECTL2=     @APACHECTL2@
 INSTALL=        @INSTALL@
+DESTDIR=
+SBINDIR=@sbindir@
 
 #    The apach 2 apxs build process tends to leave a lot of junk lying around.
 APXS2JUNKFILES=	../../common/argcargv.slo ../../common/argcargv.lo \
@@ -56,7 +58,8 @@ mod_cosign.la: ${SRC}
 #   install the DSO file into the Apache installation
 #   and activate it in the Apache configuration
 install: all
-	$(APXS2) -i -a -n 'cosign' mod_cosign.la
+	-mkdir -p $(DESTDIR)${SBINDIR}
+	${INSTALL} -m 0755 -c .libs/mod_cosign.so $(DESTDIR)${SBINDIR}/;
 
 #   cleanup
 clean:
diff --git a/html/Makefile.in b/html/Makefile.in
index f72b6b5..8785b78 100755
--- a/html/Makefile.in
+++ b/html/Makefile.in
@@ -6,25 +6,26 @@ TMPLDIR  = @prefix@/templates
 HTMLDIR  = @prefix@/html
 SERVICESDIR  = @prefix@/services
 INSTALL	=	@INSTALL@
+DESTDIR=
 
 all: ${TEMPLATES}
 
 install : all
-	-mkdir -p ${exec_prefix}
-	-mkdir -p ${TMPLDIR}
-	-mkdir -p ${HTMLDIR}
+	-mkdir -p $(DESTDIR)${exec_prefix}
+	-mkdir -p $(DESTDIR)${TMPLDIR}
+	-mkdir -p $(DESTDIR)${HTMLDIR}
 	for i in ${TEMPLATES}; do \
-	    ${INSTALL} -m 0644 -c $$i ${TMPLDIR}/; \
+	    ${INSTALL} -m 0644 -c $$i $(DESTDIR)${TMPLDIR}/; \
 	done
 	for i in ${HTML}; do \
-	    ${INSTALL} -m 0644 -c $$i ${HTMLDIR}/; \
+	    ${INSTALL} -m 0644 -c $$i $(DESTDIR)${HTMLDIR}/; \
 	done
-	-mkdir -p ${HTMLDIR}/images
-	cp images/*.gif ${HTMLDIR}/images/
-	cp images/*.png ${HTMLDIR}/images/
-	-mkdir -p ${HTMLDIR}/js
-	cp js/*.js ${HTMLDIR}/js/
-	-mkdir -p ${SERVICESDIR}
-	cp services/*.html ${SERVICESDIR}/
+	-mkdir -p $(DESTDIR)${HTMLDIR}/images
+	cp images/*.gif $(DESTDIR)${HTMLDIR}/images/
+	cp images/*.png $(DESTDIR)${HTMLDIR}/images/
+	-mkdir -p $(DESTDIR)${HTMLDIR}/js
+	cp js/*.js $(DESTDIR)${HTMLDIR}/js/
+	-mkdir -p $(DESTDIR)${SERVICESDIR}
+	cp services/*.html $(DESTDIR)${SERVICESDIR}/
 
 clean:
diff --git a/libsnet/Makefile.in b/libsnet/Makefile.in
index 43205f8..8914dd9 100755
--- a/libsnet/Makefile.in
+++ b/libsnet/Makefile.in
@@ -6,6 +6,7 @@ VPATH=@srcdir@
 prefix      =	@prefix@
 libdir      =	@libdir@
 includedir  =	@includedir@
+DESTDIR=
 
 SRC  = snet.c
 OBJ  = snet.o
@@ -58,18 +59,18 @@ libsnet.la:	$(OBJ) $(LOBJ)
 	  -version-info 0:0:0 >/dev/null 2>&1 ) ; fi
 
 install:	all
-	mkdir -p $(libdir)
-	chmod 755 $(libdir)
-	mkdir -p $(includedir)
-	chmod 755 $(includedir)
-	$(INSTALL) -c -m 644 snet.h $(includedir)/snet.h
+	mkdir -p $(DESTDIR)$(libdir)
+	chmod 755 $(DESTDIR)$(libdir)
+	mkdir -p $(DESTDIR)$(includedir)
+	chmod 755 $(DESTDIR)$(includedir)
+	$(INSTALL) -c -m 644 snet.h $(DESTDIR)$(includedir)/snet.h
 	$(LIBTOOL) --mode=install \
-	  $(INSTALL) -c -m 644 libsnet.la $(libdir)/libsnet.la
+	  $(INSTALL) -c -m 644 libsnet.la $(DESTDIR)$(libdir)/libsnet.la
 	@if test x_$(PROFILED) = x_true ; then \
 	  echo "installing profiled libraries" ; \
 	  ( cd profiled ; ../$(LIBTOOL) --mode=install \
 	  $(INSTALL) -c -m 644 libsnet_p.la \
-	  $(libdir)/libsnet_p.la >/dev/null 2>&1 ) ; fi
+	  $(DESTDIR)$(libdir)/libsnet_p.la >/dev/null 2>&1 ) ; fi
 
 clean:
 	rm -f *.o *.lo *.slo libsnet.la
-- 
tg: (d1adc40..) t/autotools_for_setup (depends on: master)
